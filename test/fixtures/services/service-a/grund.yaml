version: "1"

service:
  name: service-a
  type: go
  port: 8080
  
  build:
    dockerfile: Dockerfile
    context: .
    
  health:
    endpoint: /health
    interval: 5s
    timeout: 3s
    retries: 10

requires:
  services:
    - service-b
    
  infrastructure:
    postgres:
      database: service_a_db
      migrations: ./migrations
      
    redis: true
    
    sqs:
      queues:
        - name: order-created-queue
          dlq: true
        - name: payment-queue

env:
  APP_ENV: development
  LOG_LEVEL: debug
  
env_refs:
  DATABASE_URL: "postgres://postgres:postgres@${postgres.host}:${postgres.port}/${self.postgres.database}"
  REDIS_URL: "redis://${redis.host}:${redis.port}"
  SERVICE_B_URL: "http://${service-b.host}:${service-b.port}"
